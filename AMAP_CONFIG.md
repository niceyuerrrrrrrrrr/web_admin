# 高德地图API配置说明

## 功能说明

电子围栏管理页面已集成高德地图，支持：
- 点击地图选择位置
- 拖动标记调整位置
- 搜索地址定位
- 自动定位到当前位置
- 自动填充经纬度

## 配置步骤

### 1. 申请高德地图API Key

1. 访问高德开放平台：https://console.amap.com/dev/key/app
2. 注册/登录账号
3. 创建应用，选择"Web端(JS API)"
4. 获取API Key

### 2. 配置API Key

有两种方式配置：

#### 方式一：环境变量（推荐）

在项目根目录创建 `.env` 文件：

```env
VITE_AMAP_KEY=你的高德地图API_KEY
```

#### 方式二：修改代码

编辑 `src/components/MapPicker.tsx`，找到第38行：

```typescript
const AMAP_KEY = import.meta.env.VITE_AMAP_KEY || '你的高德地图API_KEY'
```

将 `'你的高德地图API_KEY'` 替换为实际的高德地图API Key。

## 3. 配置域名白名单

在高德开放平台配置API Key时，需要设置**安全密钥（JS API）**的域名白名单。

### 需要配置的域名

#### ⚠️ 重要提示
高德地图**不支持** `localhost` 作为域名白名单，请使用 `127.0.0.1` 代替。

#### 开发环境配置
```
127.0.0.1
```
**注意**：不要配置 `localhost`，高德会提示"不合规域名"。

#### 生产环境配置（根据实际部署域名）

如果您的web-admin部署在以下域名：
- `https://admin.hodaruner.cn` → 配置 `admin.hodaruner.cn`
- `https://www.hodaruner.cn/admin` → 配置 `www.hodaruner.cn`
- 通过IP访问：`http://47.108.135.142` → 配置 `47.108.135.142`
- 其他自定义域名 → 配置对应的域名（不含协议和路径）

**推荐配置示例：**
```
127.0.0.1
admin.hodaruner.cn
www.hodaruner.cn
47.108.135.142
```

### 配置步骤

1. 登录高德开放平台：https://console.amap.com/dev/key/app
2. 找到您的应用，点击"设置"
3. 在"安全密钥（JS API）"部分，点击"添加"
4. 输入域名（不需要加 `http://` 或 `https://`，不需要加端口号）
5. 保存配置

### 注意事项

- **⚠️ localhost 不支持**：高德地图**不支持** `localhost` 作为域名白名单，请使用 `127.0.0.1` 代替
- **域名格式**：只填写域名，不要包含协议（http/https）和路径
- **端口号**：开发环境的 `127.0.0.1:5173` 只需配置 `127.0.0.1`（高德会自动匹配所有端口）
- **通配符**：不支持通配符，需要逐个添加域名
- **IP地址**：可以配置IP地址，如 `127.0.0.1`、`47.108.135.142`
- **子域名**：需要单独配置，如 `admin.example.com` 和 `www.example.com` 是不同的域名
- **开发环境访问**：如果使用 `http://localhost:5173` 访问，请改为 `http://127.0.0.1:5173` 访问
- **免费版限制**：免费版有调用次数限制，请根据实际需求选择合适的套餐
- **测试key**：如果使用测试key，功能可能受限

